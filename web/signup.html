<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign Up - HomeOps</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              50: '#f0fdf4',
              100: '#dcfce7',
              200: '#bbf7d0',
              300: '#86efac',
              400: '#4ade80',
              500: '#22c55e',
              600: '#16a34a',
              700: '#15803d',
              800: '#166534',
              900: '#14532d',
            }
          }
        }
      }
    }
  </script>
  <style>
    .member-item {
      animation: slideIn 0.2s ease;
    }
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .plan-card {
      transition: all 0.2s ease;
      cursor: pointer;
    }
    .plan-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.1);
    }
    .plan-card.selected {
      border-color: #22c55e;
      box-shadow: 0 0 0 2px #22c55e;
    }
    .plan-card .check-circle {
      display: none;
    }
    .plan-card.selected .check-circle {
      display: flex;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- Header -->
  <header class="bg-white border-b border-gray-200">
    <div class="max-w-4xl mx-auto px-4 py-4">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-brand-600 rounded-lg flex items-center justify-center">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
          </svg>
        </div>
        <div>
          <h1 class="text-xl font-bold text-gray-900">HomeOps</h1>
          <p class="text-sm text-gray-500">Household Operations Assistant</p>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-4xl mx-auto px-4 py-8">
    <div class="text-center mb-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-2">Create Your Household</h2>
      <p class="text-gray-600">Set up your household and start managing tasks via WhatsApp</p>
    </div>

    <form id="signupForm" class="space-y-8">
      <!-- Step 1: Subscriber Info -->
      <section class="bg-white rounded-xl border border-gray-200 p-6">
        <div class="flex items-center gap-3 mb-6">
          <span class="w-8 h-8 bg-brand-100 text-brand-700 rounded-full flex items-center justify-center font-semibold text-sm">1</span>
          <h3 class="text-lg font-semibold text-gray-900">Your Information</h3>
        </div>

        <div class="grid gap-4 sm:grid-cols-2">
          <div class="sm:col-span-2">
            <label for="subscriberName" class="block text-sm font-medium text-gray-700 mb-1">Your Name *</label>
            <input type="text" id="subscriberName" name="subscriber_name" required
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition"
              placeholder="Enter your full name">
          </div>

          <div>
            <label for="subscriberWhatsapp" class="block text-sm font-medium text-gray-700 mb-1">WhatsApp Number *</label>
            <input type="tel" id="subscriberWhatsapp" name="subscriber_whatsapp" required
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition"
              placeholder="+92 300 1234567">
            <p class="text-xs text-gray-500 mt-1">Include country code (e.g., +92)</p>
          </div>

          <div>
            <label for="subscriberEmail" class="block text-sm font-medium text-gray-700 mb-1">Email Address *</label>
            <input type="email" id="subscriberEmail" name="subscriber_email" required
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition"
              placeholder="you@example.com">
          </div>
        </div>
      </section>

      <!-- Step 2: Household Info -->
      <section class="bg-white rounded-xl border border-gray-200 p-6">
        <div class="flex items-center gap-3 mb-6">
          <span class="w-8 h-8 bg-brand-100 text-brand-700 rounded-full flex items-center justify-center font-semibold text-sm">2</span>
          <h3 class="text-lg font-semibold text-gray-900">Household Details</h3>
        </div>

        <div class="grid gap-4 sm:grid-cols-2">
          <div class="sm:col-span-2">
            <label for="householdName" class="block text-sm font-medium text-gray-700 mb-1">Household Name *</label>
            <input type="text" id="householdName" name="household_name" required
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition"
              placeholder="e.g., The Khan Family">
          </div>

          <div>
            <label for="timezone" class="block text-sm font-medium text-gray-700 mb-1">Timezone</label>
            <select id="timezone" name="timezone"
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition bg-white">
              <option value="Asia/Karachi" selected>Pakistan (PKT)</option>
              <option value="Asia/Dubai">UAE (GST)</option>
              <option value="Asia/Kolkata">India (IST)</option>
              <option value="Europe/London">UK (GMT/BST)</option>
              <option value="America/New_York">US Eastern</option>
              <option value="America/Los_Angeles">US Pacific</option>
            </select>
          </div>

          <!-- Default Staff Voice Note Language -->
          <div>
            <label for="ttsLanguageStaff" class="block text-sm font-medium text-gray-700 mb-1">
              Default Staff Voice Note Language
            </label>
            <select id="ttsLanguageStaff" name="tts_language_staff"
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition bg-white">
              <option value="ur" selected>Urdu (Recommended)</option>
              <option value="en">English</option>
            </select>
            <p class="text-xs text-gray-500 mt-1">Default language for staff voice notes. Override per staff member below.</p>
          </div>

          <div>
            <label for="city" class="block text-sm font-medium text-gray-700 mb-1">City *</label>
            <input type="text" id="city" name="city" required
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition"
              placeholder="e.g., Karachi">
          </div>

          <div>
            <label for="country" class="block text-sm font-medium text-gray-700 mb-1">Country *</label>
            <select id="country" name="country" required
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition bg-white">
              <option value="Pakistan" selected>Pakistan</option>
              <option value="UAE">UAE</option>
              <option value="Saudi Arabia">Saudi Arabia</option>
              <option value="India">India</option>
              <option value="United Kingdom">United Kingdom</option>
              <option value="United States">United States</option>
              <option value="Canada">Canada</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div class="sm:col-span-2">
            <label for="address" class="block text-sm font-medium text-gray-700 mb-1">Address (Optional)</label>
            <textarea id="address" name="address" rows="2"
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition resize-none"
              placeholder="Enter your address"></textarea>
          </div>
        </div>
      </section>

      <!-- Step 3: Choose Your Plan -->
      <section id="planSection" class="bg-white rounded-xl border border-gray-200 p-6">
        <div class="flex items-center gap-3 mb-4">
          <span class="w-8 h-8 bg-brand-100 text-brand-700 rounded-full flex items-center justify-center font-semibold text-sm">3</span>
          <h3 class="text-lg font-semibold text-gray-900">Choose Your Plan</h3>
        </div>

        <!-- Marketing copy -->
        <div class="text-center mb-8">
          <h4 class="text-xl font-bold text-gray-900 mb-2">One message. Everyone knows what to do.</h4>
          <p class="text-gray-500 text-sm max-w-lg mx-auto">Save 2+ hours/day on household coordination. The cost of one staff member &mdash; coordinates all of them.</p>
        </div>

        <!-- Plan Cards -->
        <div class="grid gap-4 md:grid-cols-3 mb-6" id="planCards">

          <!-- Essential -->
          <div class="plan-card relative border-2 border-gray-200 rounded-xl p-5 bg-white" data-plan="essential" onclick="selectPlan('essential')">
            <div class="check-circle absolute top-3 right-3 w-6 h-6 bg-brand-500 rounded-full items-center justify-center">
              <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"/>
              </svg>
            </div>
            <h5 class="text-lg font-bold text-gray-900 mb-1">Essential</h5>
            <div class="mb-4">
              <span class="text-2xl font-bold text-gray-900">PKR 25,000</span>
              <span class="text-sm text-gray-500">/mo</span>
            </div>
            <ul class="space-y-2.5 text-sm text-gray-600">
              <li class="flex items-start gap-2">
                <svg class="w-4 h-4 text-brand-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                Up to 5 people
              </li>
              <li class="flex items-start gap-2">
                <svg class="w-4 h-4 text-brand-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                500 tasks/mo
              </li>
              <li class="flex items-start gap-2">
                <svg class="w-4 h-4 text-brand-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                5,000 messages/mo
              </li>
              <li class="flex items-start gap-2">
                <svg class="w-4 h-4 text-brand-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                Daily text digest
              </li>
            </ul>
            <div class="mt-4 pt-3 border-t border-gray-100 text-xs text-gray-500 space-y-1">
              <p class="font-medium text-gray-600">Voice notes: +PKR 7,000/staff/mo add-on</p>
              <p>1,200 voice notes/mo pool shared across staff. E.g. 2 staff with voice = 600 each on average.</p>
            </div>
          </div>

          <!-- Pro (Most Popular) -->
          <div class="plan-card selected relative border-2 border-brand-500 rounded-xl p-5 bg-white" data-plan="pro" onclick="selectPlan('pro')">
            <div class="absolute -top-3 left-1/2 -translate-x-1/2">
              <span class="bg-brand-500 text-white text-xs font-bold px-3 py-1 rounded-full whitespace-nowrap">Most Popular</span>
            </div>
            <div class="check-circle absolute top-3 right-3 w-6 h-6 bg-brand-500 rounded-full items-center justify-center">
              <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"/>
              </svg>
            </div>
            <h5 class="text-lg font-bold text-gray-900 mb-1">Pro</h5>
            <div class="mb-4">
              <span class="text-2xl font-bold text-gray-900">PKR 50,000</span>
              <span class="text-sm text-gray-500">/mo</span>
            </div>
            <ul class="space-y-2.5 text-sm text-gray-600">
              <li class="flex items-start gap-2">
                <svg class="w-4 h-4 text-brand-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                Up to 8 people
              </li>
              <li class="flex items-start gap-2">
                <svg class="w-4 h-4 text-brand-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                1,000 tasks/mo
              </li>
              <li class="flex items-start gap-2">
                <svg class="w-4 h-4 text-brand-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                12,000 messages/mo
              </li>
              <li class="flex items-start gap-2">
                <svg class="w-4 h-4 text-brand-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                2,500 voice notes/mo (included)
              </li>
              <li class="flex items-start gap-2">
                <svg class="w-4 h-4 text-brand-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                Daily text digest
              </li>
            </ul>
            <div class="mt-4 pt-3 border-t border-gray-100 text-xs text-gray-500">
              Voice pool shared across all staff
            </div>
          </div>

          <!-- Max -->
          <div class="plan-card relative border-2 border-gray-200 rounded-xl p-5 bg-white" data-plan="max" onclick="selectPlan('max')">
            <div class="check-circle absolute top-3 right-3 w-6 h-6 bg-brand-500 rounded-full items-center justify-center">
              <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"/>
              </svg>
            </div>
            <h5 class="text-lg font-bold text-gray-900 mb-1">Max</h5>
            <div class="mb-4">
              <span class="text-2xl font-bold text-gray-900">PKR 100,000</span>
              <span class="text-sm text-gray-500">/mo</span>
            </div>
            <ul class="space-y-2.5 text-sm text-gray-600">
              <li class="flex items-start gap-2">
                <svg class="w-4 h-4 text-brand-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                Up to 15 people
              </li>
              <li class="flex items-start gap-2">
                <svg class="w-4 h-4 text-brand-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                2,000 tasks/mo
              </li>
              <li class="flex items-start gap-2">
                <svg class="w-4 h-4 text-brand-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                25,000 messages/mo
              </li>
              <li class="flex items-start gap-2">
                <svg class="w-4 h-4 text-brand-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                6,000 voice notes/mo (included)
              </li>
              <li class="flex items-start gap-2">
                <svg class="w-4 h-4 text-brand-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                Daily text digest
              </li>
            </ul>
            <div class="mt-4 pt-3 border-t border-gray-100 text-xs text-gray-500">
              Voice pool shared across all staff
            </div>
          </div>
        </div>

        <!-- Add-ons & voice note info -->
        <div class="bg-gray-50 rounded-lg p-4 border border-gray-100 mb-3">
          <p class="text-sm font-medium text-gray-700 mb-2">Add-ons</p>
          <div class="flex flex-col sm:flex-row sm:gap-6 gap-1 text-sm text-gray-500">
            <span>Extra people: <strong class="text-gray-700">+PKR 5,000/person/mo</strong></span>
            <span id="voiceAddonInfo">Voice add-on (Essential): <strong class="text-gray-700">+PKR 7,000/staff/mo</strong></span>
          </div>
        </div>

        <div class="bg-blue-50 rounded-lg p-4 border border-blue-100 mb-4">
          <p class="text-sm font-medium text-gray-700 mb-1">How voice notes work</p>
          <p class="text-xs text-gray-600">Only voice notes <strong>sent by HomeOps to staff</strong> count toward your pool. Voice notes <strong>you send to HomeOps</strong> don't count toward your voice pool â€” they only use your message allowance.</p>
        </div>

        <p class="text-center text-xs text-gray-400">Cancel anytime. No contracts.</p>
      </section>

      <!-- Step 4: Members -->
      <section class="bg-white rounded-xl border border-gray-200 p-6">
        <div class="flex items-center justify-between mb-6">
          <div class="flex items-center gap-3">
            <span class="w-8 h-8 bg-brand-100 text-brand-700 rounded-full flex items-center justify-center font-semibold text-sm">4</span>
            <div>
              <h3 class="text-lg font-semibold text-gray-900">Household Members & Staff</h3>
              <p class="text-sm text-gray-500" id="memberSubtitle">Add family members and household staff</p>
            </div>
          </div>
          <span id="memberCount" class="text-sm text-gray-500">0 people</span>
        </div>

        <!-- Plan-aware limit notice -->
        <div id="memberLimitNotice" class="mb-4 p-3 bg-brand-50 border border-brand-100 rounded-lg text-sm text-brand-800">
          <span id="memberLimitText">Your Pro plan includes up to 8 people (including you). Extra people are +PKR 5,000/person/mo.</span>
        </div>

        <div id="membersContainer" class="space-y-4 mb-4">
          <!-- Members will be added here -->
        </div>

        <button type="button" id="addMemberBtn"
          class="w-full py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-brand-500 hover:text-brand-600 transition flex items-center justify-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
          </svg>
          Add Person
        </button>
      </section>

      <!-- Step 5: Pricing Summary -->
      <section class="bg-white rounded-xl border border-gray-200 p-6">
        <div class="flex items-center gap-3 mb-6">
          <span class="w-8 h-8 bg-brand-100 text-brand-700 rounded-full flex items-center justify-center font-semibold text-sm">5</span>
          <h3 class="text-lg font-semibold text-gray-900">Pricing Summary</h3>
        </div>

        <!-- Price breakdown -->
        <div class="bg-gray-50 rounded-lg p-5 border border-gray-100">
          <div class="space-y-2.5 text-sm">
            <div class="flex justify-between text-gray-700">
              <span id="pricingPlanLabel">Your Plan: Pro</span>
              <span id="pricingPlanAmount" class="font-medium">PKR 50,000</span>
            </div>
            <div class="flex justify-between text-gray-500 text-xs pl-4">
              <span id="pricingIncludedNote">8 people included</span>
              <span></span>
            </div>
            <div id="pricingExtraRow" class="flex justify-between text-gray-600 hidden">
              <span id="pricingExtraLabel">+ 0 extra people</span>
              <span id="pricingExtraAmount">PKR 0</span>
            </div>
            <div id="pricingVoiceRow" class="flex justify-between text-gray-600">
              <span id="pricingVoiceLabel">Voice notes for all staff (included)</span>
              <span id="pricingVoiceAmount" class="text-brand-600 font-medium">Included</span>
            </div>
            <div class="border-t border-gray-300 pt-3 mt-3 flex justify-between font-bold text-gray-900 text-base">
              <span>Monthly Total</span>
              <span id="pricingTotal">PKR 50,000</span>
            </div>
          </div>
          <!-- Limits footer -->
          <div id="pricingLimits" class="mt-4 pt-3 border-t border-gray-200 text-xs text-gray-400 text-center">
            Limits: 1,000 tasks/mo &middot; 12,000 messages/mo
          </div>
        </div>

        <input type="hidden" name="billing_cycle" value="monthly">
      </section>

      <!-- Submit -->
      <div id="formSection" class="bg-white rounded-xl border border-gray-200 p-6">
        <div id="formError" class="hidden mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm"></div>

        <button type="submit" id="submitBtn"
          class="w-full py-3 bg-brand-600 hover:bg-brand-700 text-white font-semibold rounded-lg transition flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
          <span id="submitText">Create Household</span>
          <svg id="submitSpinner" class="hidden w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
        </button>

        <p class="text-center text-sm text-gray-500 mt-4">
          By signing up, you agree to our
          <a href="#" class="text-brand-600 hover:underline">Terms of Service</a> and
          <a href="#" class="text-brand-600 hover:underline">Privacy Policy</a>
        </p>
      </div>

      <!-- Success Message (hidden by default) -->
      <div id="successSection" class="hidden bg-white rounded-xl border border-gray-200 p-6">
        <div class="text-center">
          <div class="w-16 h-16 bg-brand-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-brand-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
          </div>
          <h3 id="successTitle" class="text-xl font-bold text-gray-900 mb-2">Success!</h3>
          <div id="successMessage" class="text-gray-600 mb-6"></div>
          <a href="/" class="inline-block px-6 py-2 bg-brand-600 hover:bg-brand-700 text-white font-medium rounded-lg transition">
            Back to Home
          </a>
        </div>
      </div>
    </form>
  </main>

  <!-- Footer -->
  <footer class="border-t border-gray-200 mt-16">
    <div class="max-w-4xl mx-auto px-4 py-6 text-center text-sm text-gray-500">
      <p>&copy; 2024 HomeOps. All rights reserved.</p>
    </div>
  </footer>

  <script>
    // Configuration
    const API_ENDPOINT = '/api/signup';

    // Plan definitions
    const PLANS = {
      essential: {
        name: 'Essential',
        base: 25000,
        included_people: 5,
        tasks_per_month: 500,
        messages_per_month: 5000,
        voice_pool: 1200,
        voice_included: false,
        extra_person_price: 5000,
        voice_addon_price: 7000
      },
      pro: {
        name: 'Pro',
        base: 50000,
        included_people: 8,
        tasks_per_month: 1000,
        messages_per_month: 12000,
        voice_pool: 2500,
        voice_included: true,
        extra_person_price: 5000,
        voice_addon_price: 0
      },
      max: {
        name: 'Max',
        base: 100000,
        included_people: 15,
        tasks_per_month: 2000,
        messages_per_month: 25000,
        voice_pool: 6000,
        voice_included: true,
        extra_person_price: 5000,
        voice_addon_price: 0
      }
    };

    // State
    let selectedPlan = 'pro';
    let members = [];

    // DOM Elements
    const form = document.getElementById('signupForm');
    const membersContainer = document.getElementById('membersContainer');
    const addMemberBtn = document.getElementById('addMemberBtn');
    const memberCount = document.getElementById('memberCount');
    const submitBtn = document.getElementById('submitBtn');
    const submitText = document.getElementById('submitText');
    const submitSpinner = document.getElementById('submitSpinner');
    const formError = document.getElementById('formError');
    const formSection = document.getElementById('formSection');
    const successSection = document.getElementById('successSection');
    const successTitle = document.getElementById('successTitle');
    const successMessage = document.getElementById('successMessage');

    // Initialize
    function init() {
      // Pre-fill phone from URL params
      const urlParams = new URLSearchParams(window.location.search);
      const phone = urlParams.get('phone');
      if (phone) {
        document.getElementById('subscriberWhatsapp').value = decodeURIComponent(phone);
      }

      // Add member button
      addMemberBtn.addEventListener('click', addMember);

      // Form submission
      form.addEventListener('submit', handleSubmit);

      // Set default plan
      selectPlan('pro');
    }

    function selectPlan(planKey) {
      selectedPlan = planKey;
      const plan = PLANS[planKey];

      // Update card visual states
      document.querySelectorAll('.plan-card').forEach(card => {
        if (card.dataset.plan === planKey) {
          card.classList.add('selected');
          // Restore "Most Popular" border for Pro even when selected
          if (planKey !== 'pro') {
            card.style.borderColor = '#22c55e';
          }
        } else {
          card.classList.remove('selected');
          card.style.borderColor = '';
          // Reset non-selected cards to default gray border
          if (card.dataset.plan !== 'pro' || planKey !== card.dataset.plan) {
            // Only reset border if it's not the pro card or if pro is not selected
          }
        }
      });

      // Reset Pro card border when a different plan is selected
      const proCard = document.querySelector('.plan-card[data-plan="pro"]');
      if (planKey !== 'pro') {
        proCard.style.borderColor = '';
        proCard.classList.remove('selected');
      }

      // Update voice add-on info visibility
      const voiceAddonInfo = document.getElementById('voiceAddonInfo');
      if (plan.voice_included) {
        voiceAddonInfo.innerHTML = 'Voice notes: <strong class="text-brand-600">Included in your plan</strong>';
      } else {
        voiceAddonInfo.innerHTML = 'Voice add-on (Essential only): <strong class="text-gray-700">+PKR 7,000/staff/mo</strong>';
      }

      // Update member limit notice
      document.getElementById('memberLimitText').textContent =
        `Your ${plan.name} plan includes up to ${plan.included_people} people (including you). Extra people are +PKR 5,000/person/mo.`;

      // Update all existing member voice sections based on plan
      updateAllMemberVoiceSections();

      // Recalculate pricing
      updatePricing();
    }

    function updateAllMemberVoiceSections() {
      const plan = PLANS[selectedPlan];

      members.forEach(member => {
        const memberEl = membersContainer.querySelector(`.member-item[data-member-id="${member.id}"]`);
        if (!memberEl) return;

        if (member.role === 'staff') {
          const voiceContainer = memberEl.querySelector('.member-voice-container');
          voiceContainer.classList.remove('hidden');

          if (plan.voice_included) {
            // Pro/Max: voice is included, show "included" text, hide toggle
            member.voice_notes_enabled = true;
            voiceContainer.innerHTML = buildVoiceIncludedHtml(member.id, member.voice_language);
            attachVoiceLanguageListener(memberEl, member);
          } else {
            // Essential: show toggle with +PKR 7,000/mo
            voiceContainer.innerHTML = buildVoiceToggleHtml(member.id, member.voice_notes_enabled, member.voice_language);
            attachVoiceToggleListeners(memberEl, member);
          }
        }
      });
    }

    function buildVoiceIncludedHtml(memberId, voiceLanguage) {
      const defaultLang = voiceLanguage || document.getElementById('ttsLanguageStaff').value;
      return `
        <div class="flex items-center gap-4 flex-wrap">
          <span class="text-sm text-brand-600 font-medium flex items-center gap-1.5">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            Voice notes included
          </span>
          <div>
            <select class="member-voice-language px-3 py-1.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition bg-white"
              data-member-id="${memberId}">
              <option value="ur" ${defaultLang === 'ur' ? 'selected' : ''}>Urdu</option>
              <option value="en" ${defaultLang === 'en' ? 'selected' : ''}>English</option>
            </select>
          </div>
        </div>
      `;
    }

    function buildVoiceToggleHtml(memberId, isEnabled, voiceLanguage) {
      const defaultLang = voiceLanguage || document.getElementById('ttsLanguageStaff').value;
      return `
        <div class="flex items-center gap-4 flex-wrap">
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox" class="member-voice-toggle w-4 h-4 text-brand-600 rounded focus:ring-brand-500" data-member-id="${memberId}" ${isEnabled ? 'checked' : ''}>
            <span class="text-sm text-gray-600">Voice Notes <span class="text-brand-600 font-medium">(+PKR 7,000/mo)</span></span>
          </label>
          <div class="member-voice-lang-container ${isEnabled ? '' : 'hidden'}" data-member-id="${memberId}">
            <select class="member-voice-language px-3 py-1.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition bg-white"
              data-member-id="${memberId}">
              <option value="ur" ${defaultLang === 'ur' ? 'selected' : ''}>Urdu</option>
              <option value="en" ${defaultLang === 'en' ? 'selected' : ''}>English</option>
            </select>
          </div>
        </div>
      `;
    }

    function attachVoiceLanguageListener(memberEl, member) {
      const langSelect = memberEl.querySelector('.member-voice-language');
      if (langSelect) {
        langSelect.addEventListener('change', (e) => {
          member.voice_language = e.target.value;
        });
      }
    }

    function attachVoiceToggleListeners(memberEl, member) {
      const voiceToggle = memberEl.querySelector('.member-voice-toggle');
      const langContainer = memberEl.querySelector('.member-voice-lang-container');
      const langSelect = memberEl.querySelector('.member-voice-language');

      if (voiceToggle) {
        voiceToggle.addEventListener('change', (e) => {
          member.voice_notes_enabled = e.target.checked;
          if (e.target.checked) {
            const defaultLang = document.getElementById('ttsLanguageStaff').value;
            member.voice_language = member.voice_language || defaultLang;
            if (langSelect) langSelect.value = member.voice_language;
            if (langContainer) langContainer.classList.remove('hidden');
          } else {
            member.voice_language = null;
            if (langContainer) langContainer.classList.add('hidden');
          }
          updatePricing();
        });
      }

      if (langSelect) {
        langSelect.addEventListener('change', (e) => {
          member.voice_language = e.target.value;
        });
      }
    }

    function updatePricing() {
      const plan = PLANS[selectedPlan];

      // Total people = admin (1) + members added
      const totalPeople = 1 + members.length;
      const extraPeople = Math.max(0, totalPeople - plan.included_people);
      const extraTotal = extraPeople * plan.extra_person_price;

      // Voice notes pricing
      let voiceStaffCount = 0;
      let voiceTotal = 0;
      const staffMembers = members.filter(m => m.role === 'staff');

      if (plan.voice_included) {
        // Pro/Max: voice is included for all staff, cost is 0
        voiceStaffCount = staffMembers.length;
        voiceTotal = 0;
      } else {
        // Essential: voice is per-staff add-on at +7,000
        voiceStaffCount = staffMembers.filter(m => m.voice_notes_enabled).length;
        voiceTotal = voiceStaffCount * plan.voice_addon_price;
      }

      const monthlyTotal = plan.base + extraTotal + voiceTotal;

      // Plan label
      document.getElementById('pricingPlanLabel').textContent = `Your Plan: ${plan.name}`;
      document.getElementById('pricingPlanAmount').textContent = `PKR ${plan.base.toLocaleString()}`;
      document.getElementById('pricingIncludedNote').textContent = `${plan.included_people} people included`;

      // Extra people row
      const extraRow = document.getElementById('pricingExtraRow');
      if (extraPeople > 0) {
        extraRow.classList.remove('hidden');
        document.getElementById('pricingExtraLabel').textContent = `+ ${extraPeople} extra ${extraPeople === 1 ? 'person' : 'people'} (${extraPeople} \u00d7 PKR ${plan.extra_person_price.toLocaleString()})`;
        document.getElementById('pricingExtraAmount').textContent = `PKR ${extraTotal.toLocaleString()}`;
      } else {
        extraRow.classList.add('hidden');
      }

      // Voice notes row
      const voiceRow = document.getElementById('pricingVoiceRow');
      if (plan.voice_included) {
        voiceRow.classList.remove('hidden');
        if (staffMembers.length > 0) {
          document.getElementById('pricingVoiceLabel').innerHTML = `<span class="flex items-center gap-1"><svg class="w-3.5 h-3.5 text-brand-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Voice notes for ${staffMembers.length} staff (included)</span>`;
        } else {
          document.getElementById('pricingVoiceLabel').innerHTML = `<span class="flex items-center gap-1"><svg class="w-3.5 h-3.5 text-brand-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Voice notes for all staff (included)</span>`;
        }
        document.getElementById('pricingVoiceAmount').textContent = 'Included';
        document.getElementById('pricingVoiceAmount').className = 'text-brand-600 font-medium';
      } else {
        // Essential plan
        if (voiceStaffCount > 0) {
          voiceRow.classList.remove('hidden');
          document.getElementById('pricingVoiceLabel').textContent = `Voice add-on (${voiceStaffCount} staff \u00d7 PKR ${plan.voice_addon_price.toLocaleString()})`;
          document.getElementById('pricingVoiceAmount').textContent = `PKR ${voiceTotal.toLocaleString()}`;
          document.getElementById('pricingVoiceAmount').className = 'font-medium';
        } else {
          voiceRow.classList.remove('hidden');
          document.getElementById('pricingVoiceLabel').innerHTML = `<span class="text-gray-400">Voice notes not included</span>`;
          document.getElementById('pricingVoiceAmount').textContent = '\u2014';
          document.getElementById('pricingVoiceAmount').className = 'text-gray-400';
        }
      }

      document.getElementById('pricingTotal').textContent = `PKR ${monthlyTotal.toLocaleString()}`;

      // Limits footer
      const voiceLimit = plan.voice_included
        ? ` \u00b7 ${plan.voice_pool.toLocaleString()} voice notes/mo`
        : (voiceStaffCount > 0 ? ` \u00b7 ${plan.voice_pool.toLocaleString()} voice notes/mo (add-on)` : '');
      document.getElementById('pricingLimits').textContent =
        `Limits: ${plan.tasks_per_month.toLocaleString()} tasks/mo \u00b7 ${plan.messages_per_month.toLocaleString()} messages/mo${voiceLimit}`;
    }

    function addMember() {
      const plan = PLANS[selectedPlan];
      const memberId = Date.now();
      const isVoiceIncluded = plan.voice_included;

      members.push({
        id: memberId,
        name: '',
        whatsapp: '',
        nicknames: '',
        role: 'member',
        title: '',
        voice_notes_enabled: false,
        voice_language: null
      });

      const memberHtml = `
        <div class="member-item border border-gray-200 rounded-lg p-4" data-member-id="${memberId}">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center gap-4">
              <span class="text-sm font-medium text-gray-700">Person ${members.length}</span>
              <!-- Role toggle -->
              <div class="flex gap-3">
                <label class="flex items-center gap-1.5 cursor-pointer">
                  <input type="radio" name="role_${memberId}" value="member" checked
                    class="member-role w-4 h-4 text-brand-600 focus:ring-brand-500" data-member-id="${memberId}">
                  <span class="text-sm text-gray-600">Family</span>
                </label>
                <label class="flex items-center gap-1.5 cursor-pointer">
                  <input type="radio" name="role_${memberId}" value="staff"
                    class="member-role w-4 h-4 text-brand-600 focus:ring-brand-500" data-member-id="${memberId}">
                  <span class="text-sm text-gray-600">Staff</span>
                </label>
              </div>
            </div>
            <button type="button" class="remove-member text-gray-400 hover:text-red-500 transition" data-member-id="${memberId}">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>
          <div class="grid gap-3 sm:grid-cols-2 sm:grid-cols-4">
            <div>
              <input type="text" class="member-name w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition"
                placeholder="Name" data-member-id="${memberId}">
            </div>
            <div>
              <input type="tel" class="member-whatsapp w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition"
                placeholder="WhatsApp (+92...)" data-member-id="${memberId}">
            </div>
            <div>
              <input type="text" class="member-nicknames w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition"
                placeholder="Nicknames (optional, e.g. Babu, Bashu)" data-member-id="${memberId}">
            </div>
            <div class="member-title-container hidden" data-member-id="${memberId}">
              <select class="member-title w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none transition bg-white"
                data-member-id="${memberId}">
                <option value="">Job Title</option>
                <option value="driver">Driver</option>
                <option value="maid">Maid</option>
                <option value="cook">Cook</option>
                <option value="guard">Guard</option>
                <option value="gardener">Gardener</option>
                <option value="nanny">Nanny</option>
                <option value="other">Other</option>
              </select>
            </div>
          </div>
          <!-- Voice Notes (staff only) -->
          <div class="member-voice-container hidden mt-3" data-member-id="${memberId}">
          </div>
        </div>
      `;

      membersContainer.insertAdjacentHTML('beforeend', memberHtml);
      updateMemberCount();
      updatePricing();

      // Add event listeners to new member inputs
      const memberEl = membersContainer.querySelector(`.member-item[data-member-id="${memberId}"]`);
      const member = members.find(m => m.id === memberId);

      memberEl.querySelector('.member-name').addEventListener('input', (e) => {
        const m = members.find(m => m.id === memberId);
        if (m) m.name = e.target.value;
      });

      memberEl.querySelector('.member-whatsapp').addEventListener('input', (e) => {
        const m = members.find(m => m.id === memberId);
        if (m) m.whatsapp = e.target.value;
      });

      memberEl.querySelector('.member-nicknames').addEventListener('input', (e) => {
        const m = members.find(m => m.id === memberId);
        if (m) m.nicknames = e.target.value;
      });

      // Title dropdown event listener
      memberEl.querySelector('.member-title').addEventListener('change', (e) => {
        const m = members.find(m => m.id === memberId);
        if (m) m.title = e.target.value;
      });

      // Role toggle event listeners (show/hide title dropdown + voice notes)
      const roleInputs = memberEl.querySelectorAll('.member-role');
      roleInputs.forEach(input => {
        input.addEventListener('change', (e) => {
          const m = members.find(m => m.id === memberId);
          if (m) {
            m.role = e.target.value;
            m.title = '';
            m.voice_notes_enabled = false;
            m.voice_language = null;
          }

          const titleContainer = memberEl.querySelector('.member-title-container');
          const titleSelect = memberEl.querySelector('.member-title');
          const voiceContainer = memberEl.querySelector('.member-voice-container');

          if (e.target.value === 'staff') {
            titleContainer.classList.remove('hidden');
            voiceContainer.classList.remove('hidden');

            const currentPlan = PLANS[selectedPlan];
            if (currentPlan.voice_included) {
              // Pro/Max: voice is included
              m.voice_notes_enabled = true;
              m.voice_language = document.getElementById('ttsLanguageStaff').value;
              voiceContainer.innerHTML = buildVoiceIncludedHtml(memberId, m.voice_language);
              attachVoiceLanguageListener(memberEl, m);
            } else {
              // Essential: show toggle
              voiceContainer.innerHTML = buildVoiceToggleHtml(memberId, false, null);
              attachVoiceToggleListeners(memberEl, m);
            }
          } else {
            titleContainer.classList.add('hidden');
            voiceContainer.classList.add('hidden');
            voiceContainer.innerHTML = '';
          }
          titleSelect.selectedIndex = 0;
          updateMemberCount();
          updatePricing();
        });
      });

      memberEl.querySelector('.remove-member').addEventListener('click', () => removeMember(memberId));
    }

    function removeMember(memberId) {
      members = members.filter(m => m.id !== memberId);
      const memberEl = membersContainer.querySelector(`[data-member-id="${memberId}"]`);
      if (memberEl) memberEl.remove();
      updateMemberCount();
      updatePricing();

      // Update person numbers
      const memberItems = membersContainer.querySelectorAll('.member-item');
      memberItems.forEach((item, index) => {
        item.querySelector('.text-sm.font-medium').textContent = `Person ${index + 1}`;
      });
    }

    function updateMemberCount() {
      const count = members.length;
      const staffCount = members.filter(m => m.role === 'staff').length;
      const memberCountNum = count - staffCount;

      let text = '';
      if (memberCountNum > 0) text += `${memberCountNum} family`;
      if (staffCount > 0) {
        if (text) text += ', ';
        text += `${staffCount} staff`;
      }
      if (!text) text = '0 people';

      memberCount.textContent = text;
    }

    function normalizePhone(phone) {
      let normalized = phone.replace(/[\s\-\(\)]/g, '');
      if (!normalized.startsWith('+')) {
        if (normalized.startsWith('0')) {
          normalized = '+92' + normalized.substring(1);
        } else {
          normalized = '+' + normalized;
        }
      }
      return normalized;
    }

    function validatePhone(phone) {
      const normalized = normalizePhone(phone);
      return /^\+[1-9]\d{9,14}$/.test(normalized);
    }

    function showError(message) {
      formError.textContent = message;
      formError.classList.remove('hidden');
      formError.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    function hideError() {
      formError.classList.add('hidden');
    }

    function setLoading(loading) {
      submitBtn.disabled = loading;
      submitText.textContent = loading ? 'Processing...' : 'Create Household';
      submitSpinner.classList.toggle('hidden', !loading);
    }

    function showSuccess(title, message) {
      form.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
      formSection.classList.add('hidden');
      successSection.classList.remove('hidden');
      successTitle.textContent = title;
      successMessage.innerHTML = message;
      successSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    async function handleSubmit(e) {
      e.preventDefault();
      hideError();

      const plan = PLANS[selectedPlan];

      // Validate subscriber phone
      const subscriberWhatsapp = document.getElementById('subscriberWhatsapp').value;
      if (!validatePhone(subscriberWhatsapp)) {
        showError('Please enter a valid WhatsApp number with country code (e.g., +92 300 1234567)');
        return;
      }

      // Validate member phones
      const validMembers = members.filter(m => m.name.trim() && m.whatsapp.trim());
      for (const member of validMembers) {
        if (!validatePhone(member.whatsapp)) {
          showError(`Please enter a valid WhatsApp number for ${member.name || 'person'}`);
          return;
        }
      }

      // Calculate pricing
      const totalPeople = 1 + validMembers.length;
      const extraPeopleCount = Math.max(0, totalPeople - plan.included_people);
      const extraPeopleTotal = extraPeopleCount * plan.extra_person_price;

      let voiceNotesCount = 0;
      let voiceNotesTotal = 0;
      const staffMembers = validMembers.filter(m => m.role === 'staff');

      if (plan.voice_included) {
        // Pro/Max: all staff get voice, included in base
        voiceNotesCount = staffMembers.length;
        voiceNotesTotal = 0;
      } else {
        // Essential: per-staff add-on
        voiceNotesCount = staffMembers.filter(m => m.voice_notes_enabled).length;
        voiceNotesTotal = voiceNotesCount * plan.voice_addon_price;
      }

      const monthlyTotal = plan.base + extraPeopleTotal + voiceNotesTotal;

      // Build form data
      const formData = {
        subscriber: {
          name: document.getElementById('subscriberName').value.trim(),
          whatsapp: normalizePhone(subscriberWhatsapp),
          email: document.getElementById('subscriberEmail').value.trim()
        },
        household: {
          name: document.getElementById('householdName').value.trim(),
          timezone: document.getElementById('timezone').value,
          city: document.getElementById('city').value.trim(),
          country: document.getElementById('country').value,
          address: document.getElementById('address').value.trim()
        },
        plan: selectedPlan,
        pricing: {
          plan_base: plan.base,
          extra_people_count: extraPeopleCount,
          extra_people_total: extraPeopleTotal,
          voice_notes_count: voiceNotesCount,
          voice_notes_total: voiceNotesTotal,
          monthly_total: monthlyTotal
        },
        tts_language_staff: document.getElementById('ttsLanguageStaff').value,
        members: validMembers.map(m => {
          const isStaff = m.role === 'staff';
          let voiceEnabled = false;
          let voiceLang = null;

          if (isStaff) {
            if (plan.voice_included) {
              voiceEnabled = true;
              voiceLang = m.voice_language || document.getElementById('ttsLanguageStaff').value;
            } else {
              voiceEnabled = m.voice_notes_enabled;
              voiceLang = m.voice_notes_enabled ? (m.voice_language || null) : null;
            }
          }

          return {
            name: m.name.trim(),
            whatsapp: normalizePhone(m.whatsapp),
            nicknames: m.nicknames.trim() || null,
            role: m.role,
            title: isStaff ? (m.title || null) : null,
            voice_notes_enabled: voiceEnabled,
            voice_language: voiceLang
          };
        })
      };

      setLoading(true);

      try {
        const response = await fetch(API_ENDPOINT, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || data.message || 'Something went wrong');
        }

        if (data.status === 'activated') {
          showSuccess(
            'Welcome to HomeOps!',
            `<p class="mb-4">Your household <strong>"${formData.household.name}"</strong> is now active.</p>
            <p class="mb-4">You can start using HomeOps via WhatsApp immediately!</p>
            <p class="text-sm text-gray-500">Send a message to our WhatsApp number to get started.</p>`
          );
        } else if (data.status === 'awaiting_payment') {
          showSuccess(
            'Thank You for Signing Up!',
            `<p class="mb-4">Your signup for <strong>"${formData.household.name}"</strong> is pending activation.</p>
            <div class="bg-gray-50 rounded-lg p-4 mb-4 text-left">
              <p class="font-medium text-gray-900 mb-1">Plan: <strong>${plan.name}</strong></p>
              <p class="font-medium text-gray-900 mb-2">Monthly amount: <strong>PKR ${monthlyTotal.toLocaleString()}</strong></p>
              <p class="font-medium text-gray-900 mb-2">Please complete payment via:</p>
              <ul class="text-sm text-gray-600 space-y-1">
                <li><strong>JazzCash:</strong> ${data.payment_jazzcash || '03XX-XXXXXXX'}</li>
                <li><strong>EasyPaisa:</strong> ${data.payment_easypaisa || '03XX-XXXXXXX'}</li>
                <li><strong>Bank Transfer:</strong> ${data.payment_bank || 'Contact for details'}</li>
              </ul>
            </div>
            <p class="text-sm text-gray-500">Once payment is confirmed, your household will be activated within 24 hours. You'll receive a WhatsApp message when ready.</p>`
          );
        } else {
          throw new Error('Unexpected response from server');
        }
      } catch (error) {
        console.error('Signup error:', error);
        showError(error.message || 'Failed to process signup. Please try again.');
        setLoading(false);
      }
    }

    // Initialize on DOM ready
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
